<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>TO OUR SHARED : SEARCH</title>

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css?family=Mansalva|Nanum+Gothic|Nanum+Myeongjo|Noto+Sans+KR|Lora|East+Sea+Dokdo|Jua&display=swap" rel="stylesheet">

    <!-- ICON -->
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
        }


        < !-- modal-cost and TravelRoute-->
        .modal-cost {

            display: flex;
            flex-direction: row-reverse;
            width: 100%;

        }

        #travelRoute {
            list-style: none;
        }

        .modal-cost-area,
        #travelRoute_wrap {
            width: auto;
            height: 700px;
            border: 1px solid rgba(0, 0, 0, 0.6);
            background-color: #eee;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
        }

        .cost-header,
        .travelRoute-header {
            cursor: default;
            width: 100%;
            height: 80px;
            padding: 10px;
            background-color: #e2e2e2;
            border-top-left-radius: 4px;
            border-top-right-radius: 4px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;

        }

        .cost-header .chTitle,
        .travelRoute-header .trTitle {
            font-size: 23px;
            font-weight: 700;
        }

        .cost-header .chBody,
        .travelRoute-header .trBody {
            font-size: 15px;
        }

        .cost-body,
        .travelRoute {
            width: 100%;
            height: 100%;
            padding: 0px 10px 10px;
            overflow: auto;
        }

        .costItem,
        .travelPoint {
            cursor: default;
            padding: 10px 0 5px;
            border-bottom: 1px dashed rgba(0, 0, 0, 0.2);
        }

        .costItem-header span {
            font-size: 40px;
            font-family: 'East Sea Dokdo', cursive;
        }

        .costItem-body ul {
            padding: 0 5px 0 20px;
            list-style-type: circle;
        }

        .costItem-body li {
            font-size: 12px;
        }

        < !--bootstrap customize-->.row {
            width: 100%;
        }

        .btn-group-sm>.btn,
        .btn-sm {
            font-size: 8px;
        }

        .form-control-sm {
            font-size: 10px;
        }

        

        .btn-warning{
            box-sizing: content-box;
            font-size: 2px;
            padding-top: 0px;
            padding-bottom: 10px;
            padding-left: 0px;
            padding-right: 0px;
            width: 20px;
            height: 10px;
        }

    </style>

</head>

<body>

    <div class="row">
        <div class="col-sm">
            <div id="travelRoute_wrap">
                <div class="travelRoute-header">
                    <span class="trTitle">Ïó¨ÌñâÏßÄ</span>
                    <span class="trBody" id="trBody">Î∞©Î¨∏ : 0</span>
                </div>
                <ul id="travelRoute" class="travelRoute">
                </ul>
            </div>
        </div>
        <div class="col-sm">
            <!-- costModal -->
            <div class="modal-cost">
                <div class="modal-cost-area">
                    <div class="cost-header" id="costHeader">
                        <span class="chTitle">Ï†ÑÏ≤¥ Í≤ΩÎπÑ</span>
                        <span class="chBody">üí∞ 0</span>
                    </div>
                    <div class="cost-body" id="costBody">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="btn btn-secondary" onclick="pushTravelRouteItem(&quot;Î©îÏãúÏïº&quot;,&quot;ÏÑúÏö∏ Ïö©ÏÇ∞Íµ¨ ÌöåÎÇòÎ¨¥Î°ú13Í∞ÄÍ∏∏ 23&quot;,&quot;undefined&quot;,&quot;02-6402-0208&quot;,&quot;http://place.map.kakao.com/20128056&quot;,&quot;126.990762302788&quot;,&quot;37.5410590341706&quot;)">Ïó¨ÌñâÍ≤ΩÎ°úÏóê Ï∂îÍ∞Ä</div>
    <div class="btn btn-sm btn-warning" >x</div>






    <script>
        //------------------------------------
        //----------TravelRouteItem and travelRouteList Start
        //------------------------------------

        class TravelRouteItem {
            constructor(place_name, road_address_name, address_name, phone, place_url, x, y) {
                this.place_name = place_name;
                this.road_address_name = road_address_name;
                this.address_name = address_name;
                this.phone = phone;
                this.place_url = place_url;
                this.x = x;
                this.y = y;
                this.info = "";

            }
            setRoute(place_name, road_address_name, address_name, phone, place_url, x, y) {

                this.place_name = place_name;
                this.road_address_name = road_address_name;
                this.address_name = address_name;
                this.phone = phone;
                this.place_url = place_url;
                this.x = x;
                this.y = y;

            }
            setName(place_name) {
                this.place_name = place_name;
            }
            setInfo(info) {
                this.info = info;
            }

        }

        var TravelRouteList = Array();

        function refreashTravelRoute() {

            var travelRouteUl = document.getElementById('travelRoute'),
                trBody = document.getElementById('trBody'),
                fragment = document.createDocumentFragment(),
                itemList = '',
                el;

            ;

            // costBody Î™®Îì† ÏûêÏãù ÎÖ∏Îìú ÏÇ≠Ï†ú
            while (travelRouteUl.hasChildNodes()) {
                travelRouteUl.removeChild(travelRouteUl.firstChild);
            }
            TravelRouteList.forEach(function(currentValue, index) {

                //console.info(index);
                //console.info(currentValue);
                el = document.createElement('li'),
                    itemStr =

                    '<div class="travelRouteItem-header">' +
                    ' <div class="form-group">' +
                    ' <table>' +
                    ' <tr>' +
                    ' <td>' +
                    ' <input id="addTravelRoute_place_name_' + index + '" class="form-control form-control-sm" type="text" placeholder="Ïû•ÏÜå Ïù¥Î¶Ñ" value="' + currentValue.place_name + '" style="width:130px;" />' +
                    ' </td>' +
                    ' <td>' +
                    ' <div class="btn btn-secondary btn-sm" onclick="setTravelRouteItemName(' + index + ')">Ïù¥Î¶ÑÎ≥ÄÍ≤Ω</div>' +
                    ' </td>' +
                    ' <td>' +
                    ' <div class="btn btn-danger btn-sm" onclick="removeTravelRouteItem(' + index + ')"> x </div>' +
                    ' </td>' +
                    ' </tr>' +
                    '</table>' +
                    ' </div>' +
                    '</div>' +
                    ' <div>' +
                    '<table>' +
                    '<tr>' +
                    '<td>' +
                    ' <textarea id="addTravelRoute_info_' + index + '" class="form-control form-control-sm" type="text" placeholder="ÏÑ§Î™Ö" rows="3" style="width:130px;">' + currentValue.info + '</textarea>' +
                    '</td>' +
                    '<td style="vertical-align:top">' +
                    ' <div class="btn btn-secondary btn-sm" onclick="setTravelRouteItemInfo(' + index + ')" >ÏÑ§Î™ÖÏ†ÄÏû•</div>' +
                    '</td>' +
                    '</tr>' +
                    '</table>';
                    
                if (currentValue.address_name != "" && currentValue.address_name != "undefined") {
                    itemStr += currentValue.address_name + '<br/>';

                }
                if (currentValue.road_address_name != "" && currentValue.road_address_name != "undefined") {
                    itemStr += currentValue.road_address_name + '<br/>';

                }
                if (currentValue.phone != "" && currentValue.phone != "undefined") {
                    itemStr += currentValue.phone + '<br/>';

                }
                itemStr += '<a class="btn btn-primary btn-sm" href="' + currentValue.place_url + '" target="_blank">ÏÉÅÏÑ∏ÌéòÏù¥ÏßÄ</a>';




                itemStr += '</div>';
                el.innerHTML = itemStr;
                el.setAttribute("draggable", 'true');
                el.setAttribute("class", "travelPoint");
                el.setAttribute("id", "travelPoint_" + index);



                var itemEl = el;

                fragment.appendChild(itemEl);

                travelRouteUl.appendChild(fragment);



            });

            var trBodyStr = 'Î∞©Î¨∏ : ' + TravelRouteList.length;
            //console.info(trBody);
            trBody.innerHTML = trBodyStr;


            dragAndDropAction();

        }

        function pushTravelRouteItem(place_name, road_address_name, address_name, phone, place_url, x, y) {

            TravelRouteList.push(new TravelRouteItem(place_name, road_address_name, address_name, phone, place_url, x, y));
            addCostItemParent(place_name);
            refreashTravelRoute();

        }


        function removeTravelRouteItem(index) {
            TravelRouteList.splice(index, 1);
            removeCostItemParent(index);
            refreashTravelRoute();



        }




        function setTravelRouteItem(index, place_name, road_address_name, address_name, phone, place_url, x, y) {


            TravelRouteList[index].setRoute(place_name, road_address_name, address_name, phone, place_url, x, y);
            refreashTravelRoute();
        }

        function setTravelRouteItemName(index) {

            var addTravelRoute_place_nameId = "addTravelRoute_place_name_" + index;
            var place_name = document.getElementById(addTravelRoute_place_nameId).value;
            TravelRouteList[index].setName(place_name);
            refreashTravelRoute();

            setCostItemParentName(index);
        }

        function setTravelRouteItemInfo(index) {

            var addTravelRoute_infoId = "addTravelRoute_info_" + index;
            var info = document.getElementById(addTravelRoute_infoId).value;
            TravelRouteList[index].setInfo(info);
            refreashTravelRoute();

            setCostItemParentName(index);
        }




        function swapTravelRouteItem(fIndex, sIndex) {
            var tmp = TravelRouteList[fIndex];
            TravelRouteList[fIndex] = TravelRouteList[sIndex];
            TravelRouteList[sIndex] = tmp;
            refreashTravelRoute();
        }



        //------------------------------------
        //----------TravelRouteItem and travelRouteList END
        //------------------------------------

        //------------------------------------
        //----------CostItems and CostItemList Start
        //------------------------------------
        class CostItem {
            constructor(place_name) {
                this.itemList = Array();
                this.place_name = place_name;
            }
            setPlace_name(place_name) {
                this.place_name = place_name;
            }
            pushItem(costType, cost, info) {
                this.itemList.push({
                    costType,
                    cost,
                    info
                });
            }
            popItem() {
                this.itemList.pop();
            }
        }

        var CostItemList = Array();



        function button() {

        }


        function refreashCostItem() {

            var costBody = document.getElementById('costBody'),
                costHeader = document.getElementById('costHeader'),
                fragment = document.createDocumentFragment(),
                headerFragment = document.createDocumentFragment(),
                itemList = '',
                el, headerEl, totalCost = 0,
                pindexTmp;

            ;

            // costBody Î™®Îì† ÏûêÏãù ÎÖ∏Îìú ÏÇ≠Ï†ú
            while (costBody.hasChildNodes()) {
                costBody.removeChild(costBody.firstChild);
            }
            CostItemList.forEach(function(currentValue, pindex) {
                pindexTmp = pindex;
                //console.info(pindex);
                //console.info(currentValue);
                el = document.createElement('div'),
                    itemStr =

                    '<div class="costItem-header">' +
                    '         <span># ' + currentValue.place_name + '</span>' +
                    '</div>' +
                    '   <div class="costItem-body">' +
                    '       <ul>';

                currentValue.itemList.forEach(function(currentValue, index) {
                    itemStr += '<li>' + currentValue.costType +
                        '               <div class="btn btn-sm btn-warning" onclick="removeCostItemChild(' + pindex + ',' + index + ')">x</div>' +
                        '<br/>' +
                        setComa(currentValue.cost) + ' (' + currentValue.info + ')' + '</li>';
                    totalCost += parseInt(currentValue.cost);
                });

                itemStr +=
                    '<li>' +
                    '   <div class="btn btn-secondary btn-sm" data-toggle="collapse" data-target="#collapseAddCost_' + pindex + '" aria-expanded="false" aria-controls="collapseAddCost_' + pindex + '">Ï∂îÍ∞Ä</div>' +
                    '   <div class="collapse" id="collapseAddCost_' + pindex + '">'+
                    '       <select id="addCost_costType_' + pindex + '" class="form-control form-control-sm">' +
                    '           <option value="ÏãùÎπÑ">ÏãùÎπÑ</option>' +
                    '           <option value="ÍµêÌÜµÎπÑ">ÍµêÌÜµÎπÑ</option>' +
                    '           <option value="ÏàôÎ∞ïÎπÑ">ÏàôÎ∞ïÎπÑ</option>' +
                    '           <option value="Í∏∞ÌÉÄ">Í∏∞ÌÉÄ</option>' +
                    '       </select>' +
                    '       <input id="addCost_cost_' + pindex + '" class="form-control form-control-sm" type="number" placeholder="ÎπÑÏö©">' +
                    '       <input id="addCost_info_' + pindex + '" class="form-control form-control-sm" type="text" placeholder="ÎπÑÏö© ÏÑ§Î™Ö">' +
                    '       <div class="btn btn-secondary btn-sm" onclick="pushCostItemChild(' + pindex + ')">+</div>' +
                    '       <div class="btn btn-secondary btn-sm" onclick="popCostItemChild(' + pindex + ')">-</div>' +
                    
                    '</div>' +
                    '</li>' +
                    '   </ul>' +
                    '</div>' +
                    '</div>';
                el.innerHTML = itemStr;
                //            el.setAttribute("draggable", 'true');
                //            el.setAttribute("id", "travelPoint");
                el.setAttribute("class", "costItem");


                var itemEl = el;

                fragment.appendChild(itemEl);

                costBody.appendChild(fragment);



            });

            // ÎÇòÏ§ëÏóê ÏßÄÎèÑÏùò travelrouteÏóêÏÑú Ï∂îÍ∞ÄÌï† Î≤ÑÌäº
            //el = document.createElement('div'),
            //    itemStr =

            //    '<div class="btn btn-secondary btn-sm" onclick="addCostItemParent(' + pindexTmp + ')">+</div>';

            //el.innerHTML = itemStr;
            ////            el.setAttribute("draggable", 'true');
            ////            el.setAttribute("id", "travelPoint");
            //el.setAttribute("class", "costItem");


            //var itemEl = el;

            //fragment.appendChild(itemEl);

            //costBody.appendChild(fragment);

            ////--------------------



            var headerStr =
                '<span class="chTitle">Ï†ÑÏ≤¥ Í≤ΩÎπÑ</span>' +
                '<span class="chBody">üí∞ ' + setComa(totalCost) + '</span>';
            costHeader.innerHTML = headerStr;




        }

        function pushCostItemChild(index) {

            var costTypeId = "addCost_costType_" + index,
                costId = "addCost_cost_" + index,
                infoId = "addCost_info_" + index;

            var costType = document.getElementById(costTypeId);
            cost = document.getElementById(costId),
                info = document.getElementById(infoId);

           if(cost.value == "") {
               
               alert("ÎπÑÏö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî");
           }            
            else{
               
               CostItemList[index].pushItem(costType.options[costType.selectedIndex].value, cost.value, info.value);
            refreashCostItem();
           }
            
            

        }


        function popCostItemChild(index) {

            var costTypeId = "addCost_costType_" + index,
                costId = "addCost_cost_" + index,
                infoId = "addCost_info_" + index;

            var costType = document.getElementById(costTypeId);
            cost = document.getElementById(costId),
                info = document.getElementById(infoId);

            CostItemList[index].popItem();
            refreashCostItem();

        }




        function addCostItemParent(place_name) {
            CostItemList.push(new CostItem(place_name));
            refreashCostItem();

        }

        function setCostItemParentName(pindex) {

            //var addCost_place_nameId = "addCost_place_name_" + pindex;
            //var addCost_place_name = document.getElementById(addCost_place_nameId);
            var addTravelRoute_place_nameId = "addTravelRoute_place_name_" + pindex;
            var place_name = document.getElementById(addTravelRoute_place_nameId).value;

            CostItemList[pindex].setPlace_name(place_name);
            refreashCostItem();
        }

        function removeCostItemChild(pindex, index) {
            CostItemList[pindex].itemList.splice(index, 1);
            refreashCostItem();
        }


        function removeCostItemParent(pindex) {
            CostItemList.splice(pindex, 1);
            refreashCostItem();
        }

        function swapCostItemParent(fIndex, sIndex) {
            var tmp = CostItemList[fIndex];
            CostItemList[fIndex] = CostItemList[sIndex];
            CostItemList[sIndex] = tmp;
            refreashCostItem();
        }

        function setComa(number) {
            var resultStr = "";
            var strNumber = String(number);
            //console.info(strNumber);
            //console.info(strNumber.length);
            for (var i = strNumber.length - 1; i >= 0; i--) {
                //console.info(i);

                if ((strNumber.length - i - 1) % 3 == 0 && i != strNumber.length - 1) {
                    resultStr = ',' + resultStr;
                }
                resultStr = strNumber[i] + resultStr;
            }


            return resultStr;

        }

        //------------------------------------
        //----------CostItems and CostItemList End
        //------------------------------------


        
        
        //------------------------------------
        //----------DragManager Start
        //------------------------------------





        //Ïó¨ÌñâÍ≤ΩÎ°ú ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠
        var DragManager;

        function dragAndDropAction() {
            //DragMangerÏóê ÏöîÏÜå Ï∂îÍ∞Ä (Ï∂îÌõÑ ÎìúÎûòÍ∑∏ Ïï§ÎìúÎ°≠ Ïï°ÏÖò Ïã§Ìñâ)
            DragManager = {
                travelRoutes: [],
                currentContainer: null,

                add: function(travelRoute) {
                    this.travelRoutes.push(travelRoute);
                },

                handleEvent: function(event) {
                    //console.info(event.target);
                    if (event.type == 'dragstart') {
                        console.info("dragstart");
                        var containers = this.travelRoutes.filter(function(container) {

                            return container.contains(event.target);
                        });

                        if (containers.length > 0) {
                            this.currentContainer = containers[0];
                            this.currentContainer.activate();
                        }
                    }

                    if (this.currentContainer !== null) {
                        this.currentContainer.handleEvent(event);
                        if (event.type == 'dragend') {
                            this.currentContainer.deactivate();
                            this.currentContainer = null;
                        }
                    }
                }

            };

            window.addEventListener('dragstart', DragManager);
            window.addEventListener('dragend', DragManager);

            function travelRoute(container, type) {
                this.element = container;
                this.type = type || 'swap';
                this.items = $('> li', this.element);
                this.draggingItem = null;

                DragManager.add(this);
            }

            travelRoute.prototype.contains = function(target) {
                //console.info(target);
                return $(this.element).find(target).length;
            }

            travelRoute.prototype.handleEvent = function(event) {
                // NOTE: We've bound `this` to the travelRoute object, not
                // the element the event was fired on.
                var $t = $(event.target);

                if (event.type == 'dragstart') {
                    this.draggingItem = event.target;
                    console.info(event.target);
                    //setdataÏóê ÏµúÏÉÅÏúÑ LIdml HTMLÏùÑ Îç∞Ïù¥ÌÑ∞Î°ú Î≥¥ÎÇ∏Îã§
                    //console.info("this.draggingItem");
                    //console.info(this.draggingItem);
                    var tgtItem = this.draggingItem;
                    while (1) {
                        //if(data.id == "travelPoint")
                        //console.info("tgtItem.tagName");
                        //console.info(tgtItem.tagName);
                        //if (tgtItem.tagName == "LI")
                        if (tgtItem.className == "travelPoint")
                            break;
                        tgtItem = tgtItem.parentNode;
                    }


                    event.dataTransfer.setData('text/html', tgtItem.innerHTML);
                }

                if (event.type == 'dragover' && this.draggingItem != event.target) {

                    $t.addClass('js-active');
                    // Preventing the default action _enables_ drop. Because JS APIs.
                    if (event.preventDefault) {
                        event.preventDefault();
                    }
                    event.dataTransfer.dropEffect = 'move';
                }

                if (event.type == 'dragleave') {
                    $t.removeClass('js-active');
                }

                if (event.type == 'drop' && this.draggingItem != null) {
                    if (this.type == 'swap') {


                        // ÏµúÏÉÅÎã® LIÌÉúÍ∑∏Î•º ÌÉêÏÉâ
                        var tgtItem = event.target;
                        while (1) {
                            //if(data.id == "travelPoint")
                            //if (tgtItem.tagName == "LI")
                            if (tgtItem.className == "travelPoint")
                                break;
                            tgtItem = tgtItem.parentNode;
                        }
                        var fIndex, sIndex;
                        //travelPoint_0
                        fIndex = tgtItem.id.slice(12);
                        sIndex = this.draggingItem.id.slice(12);

                        console.info(fIndex);
                        console.info(sIndex);
                        swapTravelRouteItem(parseInt(fIndex), parseInt(sIndex));
                        swapCostItemParent(parseInt(fIndex), parseInt(sIndex));
                        //ÏµúÏÉÅÎã®  travelPointÎ°úÎßå ÏòÆÍπÄ.
                        //this.draggingItem.innerHTML = tgtItem.innerHTML;
                        //tgtItem.innerHTML = event.dataTransfer.getData('text/html');
                    } else if (this.type == 'reorder') {
                        console.info('reorder');
                        console.info(this.items.index(event.target));
                    }
                }

                if (event.type == 'dragend' || event.type == 'drop') {
                    this.items.removeClass('js-active');
                    this.draggingItem = null;
                }
            }

            travelRoute.prototype.activate = function() {
                for (var i = 0, j = this.items.length; i < j; i++) {
                    // Make sure `this` is always a travelRoute instead of the element the
                    // event was activated on.
                    this.items[i].addEventListener('dragenter', this.handleEvent.bind(this));
                    this.items[i].addEventListener('dragover', this.handleEvent.bind(this));
                    this.items[i].addEventListener('dragleave', this.handleEvent.bind(this));
                    this.items[i].addEventListener('drop', this.handleEvent.bind(this));
                }
            }

            travelRoute.prototype.deactivate = function() {
                this.draggingItem = null;
                for (var i = 0, j = this.items.length; i < j; i++) {
                    //this.items[i].removeEventListener('dragenter', this.handleEvent);
                    //this.items[i].removeEventListener('dragover', this.handleEvent);
                    //this.items[i].removeEventListener('dragleave', this.handleEvent);
                    //this.items[i].removeEventListener('drop', this.handleEvent);
                }
            }

            var travelRoutes = document.getElementsByClassName('travelRoute');

            for (var i = 0, j = travelRoutes.length; i < j; i++) {
                new travelRoute(travelRoutes[i], (i % 2 == 0) ? 'swap' : 'reorder');
            }

        }
        //------------------------------------
        //----------DragManager END
        //------------------------------------

    </script>
</body>

</html>
