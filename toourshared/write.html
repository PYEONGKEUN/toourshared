

<!DOCTYPE html>



<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>TO OUR SHARED : 글 작성 #일차</title>

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css?family=Mansalva|Nanum+Gothic|Nanum+Myeongjo|Noto+Sans+KR|Lora|East+Sea+Dokdo|Jua&display=swap" rel="stylesheet">

    <!-- ICON -->
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- summerNote -->
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.11/dist/summernote-bs4.min.css" rel="stylesheet" />

    <!-- JS -->
    <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
    <script src='https://www.google.com/recaptcha/api.js'></script>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=ebcd0c1accbe0ff4bbb47bd777ef2fcf&libraries=service&libraries=services,clusterer,drawing"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bs4-summernote@0.8.10/dist/summernote-bs4.min.js"></script>

    <link rel="stylesheet" href="css/write.css">


</head>
<body>
    <form id="form1" runat="server">

        <div id="main" class="main">
            <!-- 메인 상단 영역 -->
            <div class="TitleArea">
                <div class="TitleAlign">
                            <input type="text" ID="mapData"  value='{"arrow":[{"type":"arrow","points":[{"x":126.99694479930682,"y":37.543688472931485},{"x":126.99373165754399,"y":37.537994026852},{"x":126.99984159491969,"y":37.537669832986445},{"x":126.9999773716285,"y":37.5346064310535},{"x":127.00013577780894,"y":37.538787073361064}],"coordinate":"wgs84","options":{"strokeColor":"#39f","strokeWeight":3,"strokeStyle":"solid","strokeOpacity":0.8,"endArrow":true}},{"type":"arrow","points":[{"x":126.99961527157919,"y":37.543580391893805},{"x":126.99459115411166,"y":37.54381452850057},{"x":126.99375397128274,"y":37.54177822813693},{"x":126.99837079645059,"y":37.53280441787541}],"coordinate":"wgs84","options":{"strokeColor":"#39f","strokeWeight":3,"strokeStyle":"solid","strokeOpacity":0.8,"endArrow":true}}],"circle":[{"type":"circle","sPoint":{"x":126.98786191247991,"y":37.535066996705964},"ePoint":{"x":126.9986060788749,"y":37.54362375523264},"center":{"x":126.99323368873222,"y":37.53934549968507},"coordinate":"wgs84","options":{"strokeColor":"#39f","strokeWeight":3,"strokeStyle":"solid","strokeOpacity":1,"fillColor":"#39f","fillOpacity":0.5},"radius":474.8136476562153},{"type":"circle","sPoint":{"x":126.97868635807069,"y":37.534678422897635},"ePoint":{"x":126.99112619121239,"y":37.54458734330325},"center":{"x":126.98490586308999,"y":37.53963304889966},"coordinate":"wgs84","options":{"strokeColor":"#39f","strokeWeight":3,"strokeStyle":"solid","strokeOpacity":1,"fillColor":"#39f","fillOpacity":0.5},"radius":549.7963259253094}],"ellipse":[{"type":"ellipse","sPoint":{"x":126.99238569774678,"y":37.53318260410017},"ePoint":{"x":126.9969791131304,"y":37.534588372401664},"center":{"x":126.99468238388155,"y":37.533885510624174},"coordinate":"wgs84","options":{"strokeColor":"#39f","strokeWeight":2,"strokeStyle":"solid","strokeOpacity":0.8,"fillColor":"#39f","fillOpacity":0.3},"rx":203,"ry":78},{"type":"ellipse","sPoint":{"x":126.98611773141162,"y":37.5333261938016},"ePoint":{"x":126.99023573088284,"y":37.53557910821011},"center":{"x":126.9881767001753,"y":37.53445266905767},"coordinate":"wgs84","options":{"strokeColor":"#39f","strokeWeight":2,"strokeStyle":"solid","strokeOpacity":0.8,"fillColor":"#39f","fillOpacity":0.3},"rx":182,"ry":125}],"marker":[{"type":"marker","x":126.99192134093991,"y":37.53766955676219,"coordinate":"wgs84","zIndex":0,"icon":null,"content":""},{"type":"marker","x":126.98943180548194,"y":37.53988582068255,"coordinate":"wgs84","zIndex":0,"icon":null,"content":""},{"type":"marker","x":126.98680708815085,"y":37.5378492962226,"coordinate":"wgs84","zIndex":0,"icon":null,"content":""}],"polyline":[{"type":"polyline","points":[{"x":126.98463352409219,"y":37.54343523278505},{"x":126.98872975845497,"y":37.54332757484325},{"x":126.98825478717605,"y":37.541543549286935},{"x":126.98544859872878,"y":37.54159729682124},{"x":126.9871909733226,"y":37.542606618314714}],"coordinate":"wgs84","options":{"strokeColor":"#39f","strokeWeight":3,"strokeStyle":"solid","strokeOpacity":1}},{"type":"polyline","points":[{"x":126.99454595350188,"y":37.54296758690223},{"x":126.99701272716773,"y":37.542823515139794},{"x":126.99701281416085,"y":37.54064309576407},{"x":126.99309781024795,"y":37.54042669185029},{"x":126.99493077515768,"y":37.54154402458232}],"coordinate":"wgs84","options":{"strokeColor":"#39f","strokeWeight":3,"strokeStyle":"solid","strokeOpacity":1}}],"polygon":[{"type":"polygon","points":[{"x":126.99981895608103,"y":37.54161621322989},{"x":126.99884591639663,"y":37.53698506713634},{"x":126.99445574081497,"y":37.53876892328596},{"x":126.99757855506786,"y":37.54107558866079},{"x":126.99841582491243,"y":37.543544341915755}],"coordinate":"wgs84","options":{"strokeColor":"#39f","strokeWeight":3,"strokeStyle":"solid","strokeOpacity":1,"fillColor":"#39f","fillOpacity":0.5}},{"type":"polygon","points":[{"x":126.99033645527088,"y":37.5441386167485},{"x":126.98533566159773,"y":37.54049806304509},{"x":126.99058610595429,"y":37.538516398149326},{"x":126.9928035683297,"y":37.540949254228295},{"x":126.99133245566996,"y":37.54219253508995},{"x":126.99296168559763,"y":37.54408474244152}],"coordinate":"wgs84","options":{"strokeColor":"#39f","strokeWeight":3,"strokeStyle":"solid","strokeOpacity":1,"fillColor":"#39f","fillOpacity":0.5}}],"rectangle":[{"type":"rectangle","sPoint":{"x":126.996311597632,"y":37.53415587302301},"ePoint":{"x":126.99891379817848,"y":37.53736348796528},"coordinate":"wgs84","options":{"strokeColor":"#39f","strokeWeight":3,"strokeStyle":"solid","strokeOpacity":1,"fillColor":"#39f","fillOpacity":0.5}},{"type":"rectangle","sPoint":{"x":126.98866323506805,"y":37.53428152660122},"ePoint":{"x":126.99468202302984,"y":37.53896715373265},"coordinate":"wgs84","options":{"strokeColor":"#39f","strokeWeight":3,"strokeStyle":"solid","strokeOpacity":1,"fillColor":"#39f","fillOpacity":0.5}}]}' />
        <input type="text" ID="mapRoute"  />
        <input type="text" ID="mapCost"  />
                    <asp:TextBox ID="title"  runat="server" type="text" placeholder="게시글의 제목을 정해주세요." />
                </div>
                <div class="TitleSub">
                    <div class="SubItem">
                        <span>
                            <asp:Literal ID="Literal_day" runat="server"></asp:Literal>일 차 작성 중...</span>
                    </div>
                    <div class="SubItem">

                        <asp:DropDownList ID="goDay" runat="server" OnSelectedIndexChanged="DropDownList_goDay_SelectedIndexChanged">
                        </asp:DropDownList>

                    </div>
                </div>
            </div>

            <!-- 중앙 영역 1 -->
            <div class="MapArea">
                <div id="travelRoute_wrap">
                    <div class="travelRouteItem-Left">
                        <div class="travelRoute-header">
                            <div class="trTitle1"><span class="trTitle">여행지</span></div>
                            <div class="trTitle2"><span id="trBody">방문 : 0</span></div>
                        </div>
                        <div class="travelRoute-content">
                            <ul id="travelRoute" class="travelRoute"></ul>
                        </div>
                    </div>
                    <div class="travelRouteItem-Center">
                        <div class="travelRoute-header">
                            <button type="button" class="TIFIRST" onclick="selectOverlay('MARKER')">
                                <p>📌</p>
                                <p>마커</p>
                            </button>
                            <button type="button" onclick="selectOverlay('POLYLINE')">
                                <p>🥖</p>
                                <p>선</p>
                            </button>
                            <button type="button" onclick="selectOverlay('CIRCLE')">
                                <p>🍅</p>
                                <p>원</p>
                            </button>
                            <button type="button" onclick="selectOverlay('RECTANGLE')">
                                <p>🍱</p>
                                <p>사각형</p>
                            </button>
                            <button type="button" onclick="selectOverlay('POLYGON')">
                                <p>🍰</p>
                                <p>다각형</p>
                            </button>
                            <button type="button" onclick="selectOverlay('ELLIPSE')">
                                <p>🍪</p>
                                <p>타원</p>
                            </button>
                            <button type="button" onclick="selectOverlay('ARROW')">
                                <p>👉</p>
                                <p>화살표</p>
                            </button>
                            <button type="button" id="undo" onclick="undoAction()" disabled>
                                <p>↺</p>
                                <p>동작취소</p>
                            </button>
                            <button type="button" id="redo" onclick="redoAction()" disabled>
                                <p>↻</p>
                                <p>되돌리기</p>
                            </button>
                            <button type="button" class="TILAST" data-toggle="modal" data-target="#searchPlaceModal">
                                <p>🍳</p>
                                <p>장소검색</p>
                            </button>
                        </div>
                        <div class="map_wrap">
                            <div id="drawingMap"></div>
                        </div>
                    </div>

                    <div class="travelRouteItem-Right">
                        <div id="travelCost_wrap">
                            <div class="modal-cost">
                                <div class="modal-cost-area">
                                    <div class="cost-header" id="costHeader">
                                        <div class="chTitle1"><span class="chTitle">전체 경비</span></div>
                                        <div class="chTitle2"><span class="chBody">💰 0</span></div>
                                    </div>
                                    <div class="cost-body" id="costBody">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 중앙 영역 2 -->
            <div class="taArea">
                <div class="form-group">
                    <asp:TextBox ID="article" runat="server" TextMode="MultiLine" type="text"  name="article"></asp:TextBox>
                </div>
            </div>

            <!-- 메인페이지 영역 -->
            <div class="mainImgArea">
                <div class="mainImg_wrap">
                    <div class="mainImg_AlignLeft">
                        <div class="mainImg_Label">게시글의 메인이미지를 첨부하세요.</div>
                        <div class="mainImg_Input">
                            <asp:FileUpload ID="main_img" runat="server" />
                        </div>
                    </div>
                    <div class="mainImg_AlignRight">
                        <img src="./img/%EC%A0%9C%EC%A3%BC%EB%8F%84.jpg" alt="userMainImage" id="mainImgItem" />
                    </div>
                </div>
            </div>

            <!-- 해쉬태그 영역 -->
            <div class="hashArea">
                <asp:TextBox ID="hashtag" runat="server" type="text" placeholder="해쉬태그를 입력하세요. (ex : #여행 #추억) (스페이스바로 구분지어 주세요.)" class="hashAreaItem" />
            </div>

            <!-- 하단부 영역 -->
            <div class="btnArea">
                <!-- 임시 저장 버튼 -->
                <div class="tempSaveBtn">
                    <div onclick ="tmpSave()" class="btnAreaItem">임시 저장</div>
                </div>
                <!-- 다음 일로 이동 -->
                <div  class="nextPageBtn">
                    <div onclick ="nextDay()" class="btnAreaItem">다음 일 입력</div>
                </div>
                <!-- 글 작성 완료 버튼 -->
                <div class="finishBtn">
                    <div onclick ="endWrite()" class="btnAreaItem">글 작성 완료</div>
                </div>
            </div>
        </div>

        <!-- 장소 검색 Modal 영역 -->
        <div class="modal fade" id="searchPlaceModal" tabindex="-1" role="dialog" aria-labelledby="searchPlaceModalTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered " role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="searchPlaceModalTitle">장소 검색</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div id="menu_wrap" class="bg_white">
                            <div class="option">
                                <div>
                                    키워드 :
                                <input id="keyword" value="이태원 맛집" type="text" />
                                    <button onclick="searchPlaces();">검색하기</button>
                                </div>
                            </div>
                            <hr />
                            <ul id="placesList"></ul>
                            <div id="pagination"></div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

   
    </form>

 

       





        <!-- KAKAO -->

 <script src="javascript/write.js"></script>
    
          
<script>

//------------------------------------
//----------DataBind Start
//------------------------------------

function getMapData() {
    return manager.getData();
}
function getTravelRouteData() {
    return TravelRouteList;
}
function getCostData() {
    return CostItemList;
}

function setTravelRouteData(data) {
    TravelRouteList = data;
}
function setCostData(data) {
    CostItemList = data;
}
overlays = [];
function setDrawingMapData(mapData) {
    // Drawing Manager에서 그려진 데이터 정보를 가져옵니다 
    var data = mapData;
    console.info(data);

    // 아래 지도에 그려진 도형이 있다면 모두 지웁니다
    removeOverlays();

    console.info(data["marker"]);
    console.info(data["polyline"]);
    console.info(data["rectangle"]);
    console.info(data["circle"]);
    console.info(data["polygon"]);
    console.info(data["ellipse"]);
    console.info(data["arrow"]);
    // 지도에 가져온 데이터로 도형들을 그립니다
    drawMarker(data["marker"]);
    drawPolyline(data["polyline"]);
    drawRectangle(data["rectangle"]);
    drawCircle(data["circle"]);
    drawPolygon(data["polygon"]);
    drawEllipse(data["ellipse"]);
    drawArrow(data["arrow"]);




}

// 아래 지도에 그려진 도형이 있다면 모두 지웁니다
function removeOverlays() {
    var len = overlays.length,
        i = 0;

    for (; i < len; i++) {
        overlays[i].setMap(null);
    }

    overlays = [];
}

function drawArrow(arrow) {
    var len = arrow.length,
        i = 0;

    for (; i < len; i++) {
        var path = pointsToPath(arrow[i].points);
        var style = arrow[i].options;
        var polyline = new kakao.maps.Polyline({
            map: drawingMap,
            endArrow: true,
            path: path,
            strokeColor: style.strokeColor,
            strokeOpacity: style.strokeOpacity,
            strokeStyle: style.strokeStyle,
            strokeWeight: style.strokeWeight
        });

        overlays.push(polyline);
    }
}

function drawEllipse(ellipse) {
    var len = ellipse.length,
        i = 0;

    for (; i < len; i++) {
        var style = ellipse[i].options;
        var ellipse = new kakao.maps.Ellipse({
            map: drawingMap,
            center: new kakao.maps.LatLng(ellipse[i].center.x, ellipse[i].center.y),
            rx : ellipse[i].rx,
            ry :ellipse[i].ry,
            strokeWeight: style.strokeWeight,
            strokeColor: style.strokeColor,
            strokeOpacity: style.strokeOpacity,
            strokeStyle: style.strokeStyle,
            fillColor: style.fillColor,
            fillOpacity: style.fillOpacity
            



        });
        console.info(ellipse);
        overlays.push(ellipse);
    }
} // Drawing Manager에서 가져온 데이터 중 마커를 아래 지도에 표시하는 함수입니다
function drawMarker(markers) {
    var len = markers.length,
        i = 0;

    for (; i < len; i++) {
        var marker = new kakao.maps.Marker({
            map: drawingMap,
            position: new kakao.maps.LatLng(markers[i].y, markers[i].x),
            zIndex: markers[i].zIndex
        });

        overlays.push(marker);
    }
}

// Drawing Manager에서 가져온 데이터 중 선을 아래 지도에 표시하는 함수입니다
function drawPolyline(lines) {
    var len = lines.length,
        i = 0;

    for (; i < len; i++) {
        var path = pointsToPath(lines[i].points);
        var style = lines[i].options;
        var polyline = new kakao.maps.Polyline({
            map: drawingMap,
            path: path,
            strokeColor: style.strokeColor,
            strokeOpacity: style.strokeOpacity,
            strokeStyle: style.strokeStyle,
            strokeWeight: style.strokeWeight
        });

        overlays.push(polyline);
    }
}

// Drawing Manager에서 가져온 데이터 중 사각형을 아래 지도에 표시하는 함수입니다
function drawRectangle(rects) {
    var len = rects.length,
        i = 0;

    for (; i < len; i++) {
        var style = rects[i].options;
        var rect = new kakao.maps.Rectangle({
            map: drawingMap,
            bounds: new kakao.maps.LatLngBounds(
                new kakao.maps.LatLng(rects[i].sPoint.y, rects[i].sPoint.x),
                new kakao.maps.LatLng(rects[i].ePoint.y, rects[i].ePoint.x)
            ),
            strokeColor: style.strokeColor,
            strokeOpacity: style.strokeOpacity,
            strokeStyle: style.strokeStyle,
            strokeWeight: style.strokeWeight,
            fillColor: style.fillColor,
            fillOpacity: style.fillOpacity
        });

        overlays.push(rect);
    }
}

// Drawing Manager에서 가져온 데이터 중 원을 아래 지도에 표시하는 함수입니다
function drawCircle(circles) {
    var len = circles.length,
        i = 0;

    for (; i < len; i++) {
        var style = circles[i].options;
        var circle = new kakao.maps.Circle({
            map: drawingMap,
            center: new kakao.maps.LatLng(circles[i].center.y, circles[i].center.x),
            radius: circles[i].radius,
            strokeColor: style.strokeColor,
            strokeOpacity: style.strokeOpacity,
            strokeStyle: style.strokeStyle,
            strokeWeight: style.strokeWeight,
            fillColor: style.fillColor,
            fillOpacity: style.fillOpacity
        });

        overlays.push(circle);
    }
}

// Drawing Manager에서 가져온 데이터 중 다각형을 아래 지도에 표시하는 함수입니다
function drawPolygon(polygons) {
    var len = polygons.length,
        i = 0;

    for (; i < len; i++) {
        var path = pointsToPath(polygons[i].points);
        var style = polygons[i].options;
        var polygon = new kakao.maps.Polygon({
            map: drawingMap,
            path: path,
            strokeColor: style.strokeColor,
            strokeOpacity: style.strokeOpacity,
            strokeStyle: style.strokeStyle,
            strokeWeight: style.strokeWeight,
            fillColor: style.fillColor,
            fillOpacity: style.fillOpacity
        });

        overlays.push(polygon);
    }
}

// Drawing Manager에서 가져온 데이터 중 
// 선과 다각형의 꼭지점 정보를 kakao.maps.LatLng객체로 생성하고 배열로 반환하는 함수입니다 
function pointsToPath(points) {
    var len = points.length,
        path = [],
        i = 0;

    for (; i < len; i++) {
        var latlng = new kakao.maps.LatLng(points[i].y, points[i].x);
        path.push(latlng);
    }

    return path;
}

    //------------------------------------
    //----------DataBind  END
    //------------------------------------



      //------------------------------------
        //----------Post START
        //------------------------------------
    var form = document.createElement("form");


     // 다음페이지로 markers, polyline, rect, circle, polygon 보내는 기능
    function addDataAtForm() {

            var title = document.getElementById("title");
            var article = document.getElementById("article");
            var hashtag = document.getElementById("hashtag");
            title.setAttribute('type', "hidden");
            article.setAttribute('type', "hidden");
            hashtag.setAttribute('type', "hidden");


            
            //// Form submission canceled because the form is not connected 해결
            document.body.appendChild(form);
            form.setAttribute('method', "post");

            form.appendChild(title);
            form.appendChild(article);
            form.appendChild(hashtag);


            var mapData = document.createElement("input"); // input 엘리멘트 생성
            mapData.setAttribute("type", "hidden"); // type 속성을 hidden으로 설정
            mapData.setAttribute("name", "mapData"); // name 속성을 'stadium'으로 설정
            mapData.setAttribute("value", JSON.stringify(getMapData())); // value 속성을 삽입
            form.appendChild(mapData);

            var TravelRouteListData = document.createElement("input"); // input 엘리멘트 생성
            TravelRouteListData.setAttribute("type", "hidden"); // type 속성을 hidden으로 설정
            TravelRouteListData.setAttribute("name", "mapRoute"); // name 속성을 'stadium'으로 설정
            TravelRouteListData.setAttribute("value", JSON.stringify(getTravelRouteData())); // value 속성을 삽입
            form.appendChild(TravelRouteListData);

            var CostItemListData = document.createElement("input"); // input 엘리멘트 생성
            CostItemListData.setAttribute("type", "hidden"); // type 속성을 hidden으로 설정
            CostItemListData.setAttribute("name", "mapCost"); // name 속성을 'stadium'으로 설정
            CostItemListData.setAttribute("value", JSON.stringify(getCostData())); // value 속성을 삽입
            form.appendChild(CostItemListData);


     
            
        }


    
    function tmpSave() {
        addDataAtForm();
        form.setAttribute('action', "Write_tmpSave.aspx");
        form.submit(); // 전송
    }
    function nextDay() {
        addDataAtForm();
        form.setAttribute('action', "Write_nextDay.aspx");
        form.submit(); // 전송
    }
    function endWrite() {
        addDataAtForm();
        form.setAttribute('action', "Write_get_endWrite.aspx");
        form.submit(); // 전송
    }

        //------------------------------------
        //----------Post END
        //------------------------------------

        //------------------------------------
        //----------From Post START
        //------------------------------------
    var inputMapData = JSON.parse(document.getElementById("mapData").value);    
    if (inputMapData != "" && inputMapData != [] && inputMapData != null && inputMapData != '""') {
        setDrawingMapData(inputMapData);
        closeCusOverlay();
        refreshOverlayListener();
    }


//    TravelRouteList = JSON.parse(document.getElementById("mapRoute").value);
//    if (TravelRouteList != "" && TravelRouteList != [] && TravelRouteList != null && TravelRouteList != '""') {
//        refreashTravelRoute();
//    }
//
//    CostItemList = JSON.parse(document.getElementById("mapCost").value);
//    if (CostItemList != "" && CostItemList != [] && CostItemList != null && CostItemList != '""') {
//        refreashCostItem();
//    }
         //------------------------------------
        //----------From Post END
        //------------------------------------



</script>
        
</body>
</html>
